

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#FFA9D7">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="DC-2IP扫描查看kali主机IP：（ifconfig）  将目标靶机的“网络适配器”模式改为“NAT”模式，保证其使用与kali相同的模式，即使得二者处于同一个网段内。 使用nmap扫描确认靶机的IP地址（最好在root权限下进行操作，以防出现权限不足的情况） 1nmap -sN 192.168.204.0&#x2F;24  未打开靶机前进行kali网段IP扫描：  打开靶机后进行kali网络IP扫描：">
<meta property="og:type" content="article">
<meta property="og:title" content="DC-2">
<meta property="og:url" content="http://example.com/2024/07/24/DC-2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="DC-2IP扫描查看kali主机IP：（ifconfig）  将目标靶机的“网络适配器”模式改为“NAT”模式，保证其使用与kali相同的模式，即使得二者处于同一个网段内。 使用nmap扫描确认靶机的IP地址（最好在root权限下进行操作，以防出现权限不足的情况） 1nmap -sN 192.168.204.0&#x2F;24  未打开靶机前进行kali网段IP扫描：  打开靶机后进行kali网络IP扫描：">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721827301193.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721827357707.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721827411142.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721827522630.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721827560872.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721827634237.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721827670668.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721827720354.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721827759682.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721827793444.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721828170873.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721828285726.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721828251738.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629104913096.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629105413201.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629111815721.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629160813860.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629161500801.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629161754704.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629161951832.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629162306263.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629165118422.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629170926175.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629171052842.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629171202086.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629180120896.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629182533839.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629185111829.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629185920193.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629191506509.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629191548650.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629192912615.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629193140246.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629200237330.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629201414849.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629201941121.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629202023822.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629202509198.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629204801206.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629205337373.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629205603521.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629211244365.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629212249196.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629212501959.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629212610412.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629212859976.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629214309315.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629214442931.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629220012985.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629215624770.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629220312912.png">
<meta property="article:published_time" content="2024-07-24T01:31:12.000Z">
<meta property="article:modified_time" content="2024-07-24T14:02:17.829Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721827301193.png">
  
  
  
  <title>DC-2 - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Sweety Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/24.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.08)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="DC-2"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-07-24 09:31" pubdate>
          2024年7月24日 上午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          4.4k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          37 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">DC-2</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="DC-2"><a href="#DC-2" class="headerlink" title="DC-2"></a>DC-2</h1><h2 id="IP扫描"><a href="#IP扫描" class="headerlink" title="IP扫描"></a>IP扫描</h2><p>查看kali主机IP：（ifconfig）</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721827301193.png" srcset="/img/loading.gif" lazyload></p>
<p>将目标靶机的“网络适配器”模式改为“NAT”模式，保证其使用与kali相同的模式，即使得二者处于同一个网段内。</p>
<p>使用nmap扫描确认靶机的IP地址（最好在root权限下进行操作，以防出现权限不足的情况）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nmap -sN 192.168.204.0/24<br></code></pre></td></tr></table></figure>

<p>未打开靶机前进行kali网段IP扫描：</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721827357707.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>打开靶机后进行kali网络IP扫描：</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721827411142.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>通过对比可以得到，靶机的IP地址为：<code>192.168.204.131</code></p>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><ul>
<li><p>普通开放端口扫描</p>
<p><code>-sV</code> ：对端口上的服务程序进行扫描，扫描提供服务的版本。</p>
<p><code>-sT</code>：TCP连接扫描，不安全，速度较慢，但相对准确。</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">nmap -sV -p- 192.168.204.131<br>nmap -sT -p- 192.168.204.131<br></code></pre></td></tr></table></figure>

<p>扫描结果如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721827522630.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>可以看到，开放的端口有<code>80</code>和<code>7744</code>。</p>
<ul>
<li><p>开放端口详细扫描</p>
<p><code>-sT</code> ：TCP连接扫描，不安全，速度较慢，但相对准确</p>
<p><code>-sV</code> ： 对端口上的服务程序进行扫描，扫描提供服务的版本</p>
<p><code>-sC</code> ：表示使用默认的脚本进行扫描</p>
<p><code>-O</code> ：扫描操作系统的版本</p>
<p><code>-p </code>： 指定扫描端口</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nmap -sT -sV -sC -O -p 80,7744 192.168.204.131<br></code></pre></td></tr></table></figure>

<p>扫描结果如下：<br><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721827560872.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>由扫描结果，似乎没有什么有用的信息，比如目标靶机是使用什么框架的网站之类的。</p>
<h2 id="gobuster目录爆破"><a href="#gobuster目录爆破" class="headerlink" title="gobuster目录爆破"></a>gobuster目录爆破</h2><p>端口扫描得到的有效信息太少，所以尝试使用gobuster目录爆破去获取更多有用的信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gobuster <span class="hljs-built_in">dir</span> -u http://192.168.204.131 -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt<br></code></pre></td></tr></table></figure>

<p>爆破结果如下:</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721827634237.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>获得三个目标靶机目录下的网页链接:</p>
<blockquote>
<p> <a target="_blank" rel="noopener" href="http://192.168.204.131/wp-content/">http://192.168.204.131/wp-content/</a></p>
<p> <a target="_blank" rel="noopener" href="http://192.168.204.131/wp-includes/">http://192.168.204.131/wp-includes/</a></p>
<p> <a target="_blank" rel="noopener" href="http://192.168.204.131/wp-admin/">http://192.168.204.131/wp-admin/</a></p>
</blockquote>
<p>对这三个网页逐个进行访问:</p>
<p>① <a target="_blank" rel="noopener" href="http://192.168.204.131/wp-content/">http://192.168.204.131/wp-content/</a> 没有内容加载出来</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721827670668.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>② <a target="_blank" rel="noopener" href="http://192.168.204.131/wp-includes/">http://192.168.204.131/wp-includes/</a> 有很多php脚本文件</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721827720354.png" srcset="/img/loading.gif" lazyload></p>
<p>③ <a target="_blank" rel="noopener" href="http://192.168.204.131/wp-admin/">http://192.168.204.131/wp-admin/</a> 无法访问</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721827759682.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>而且可以发现,输入网址<code>http://192.168.204.131/wp-admin/</code>,浏览器总会将其重定向至<code>dc-2</code>导致发生错误。</p>
<h2 id="重定向修改访问"><a href="#重定向修改访问" class="headerlink" title="重定向修改访问"></a>重定向修改访问</h2><p>访问目标靶机的IP地址，<code>192.168.204.131</code>，查看网页的返回界面。如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721827793444.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>经过多次尝试之后可以得知，每次访问目标靶机IP地址时，其响应网页都会被重定向到域名<code>dc-2</code>。由此判断，该IP地址网页被做了重定向处理。</p>
<p>回顾之前的nmap详细扫描，已经展现出一些网页重定向的端倪了：</p>
<p>（由于第一次实验图片丢失，第二遍补做实验的时候nmap详细扫描出来的结果稍有变化，但第一次实验其http-title确实有如下提示）</p>
<blockquote>
<p>http-title: Did not follow redirect to <a target="_blank" rel="noopener" href="http://dc-2/">http://dc-2/</a></p>
<p>​			  未遵循重定向到<a target="_blank" rel="noopener" href="http://dc-2/">http://dc-2/</a></p>
</blockquote>
<p>解决重定向处理问题，找到原靶机主页的方法（之一）：</p>
<blockquote>
<p>对本地（kali）的host文件进行修改。</p>
<p>打开 <code>etc/hosts</code>文件，添加本地DNS记录 <code>192.168.204.131 dc-2</code></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /etc/hosts<br></code></pre></td></tr></table></figure>

<p>然后在上方的<code>IP-域名</code>处添加靶机IP与“dc-2”的关联记录。</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721828170873.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>然后在浏览器中重新访问靶机IP地址，得到的效果如下：</p>
<blockquote>
<p>注意! 这里的DNS记录添加到的是kali内部的<code>hosts</code>文件，所以重定向修改生效的效果也只会在kali虚拟机内部展现出来。</p>
<p>如果想要在自己的物理主机上也能实现重定向修改的话，需要修改<code>本物理主机的hosts</code>文件。以管理员权限访问 <code>C:\Windows\System32\drivers\etc</code>下的hosts文件，添加靶机IP与“dc-2”的关联记录。</p>
</blockquote>
<p>在kali浏览器中访问网址<code>192.168.204.131</code>，得到的效果如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721828285726.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>可以看到，已经不是之前的重定向无响应界面了，网址的返回网页是正常网页类型。</p>
<h2 id="Flag1"><a href="#Flag1" class="headerlink" title="Flag1"></a>Flag1</h2><p>环视网页内容，可以发现右下角有一个<code>flag1</code>字样的选择栏，点进去：</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/QQ_1721828251738.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>flag1有一个提示信息：</p>
<blockquote>
<p>Flag 1:</p>
<p>Your usual wordlists probably won’t work, so instead, maybe you just need to be cewl.</p>
<p>你通常的单词表（字典）可能不起作用，因此，也许你只需要（成为）cewl</p>
</blockquote>
<p>cewl是什么？经过网络查询。</p>
<table>
<thead>
<tr>
<th align="left">cewl，自定义词表生成器，是一个ruby程序，是kali linux下的一个工具。可以将特定URL爬取到定义的深度并返回关键字列表（字典）。密码破解者如John the Ripper、Medusa和 WFuzz 可以使用这些关键字来破解密码。Cewl 还有一个相关的命令行应用程序 FAB，它使用相同的元数据提取技术，使用 CeWL 等信息提取算法从已下载的文件中生成作者&#x2F;制作者列表。</th>
</tr>
</thead>
</table>
<p>Kali Linux字典生成工具Cewl使用全指南：</p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/network/190128.html">https://www.freebuf.com/articles/network/190128.html</a></p>
<p>你以为接下来就是要开始使用cewl啦？别急，我们先干接下来这事。</p>
<p>回顾靶场dc-1，我们通过识别nmap漏扫获取了网页的使用框架，然后通过metasploit查找该框架的漏洞。利用漏洞实现了用户登陆以及用户提权。</p>
<p>所以在dc-2这个靶场中，我们也尝试通过获取目标网页所使用框架等技术构成信息。但是前面的端口扫描也没有扫出什么有用的信息，所以我们尝试使用whatweb指纹工具来进行识别。</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629104913096.png" srcset="/img/loading.gif" lazyload alt="image-20240629104913096"></p>
<p>或者利用浏览器插件wappalyer进行指纹识别：</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629105413201.png" srcset="/img/loading.gif" lazyload alt="image-20240629105413201"></p>
<p>得到的部分信息如下：</p>
<blockquote>
<p> WordPress 4.7.10</p>
<p> Apache 2.4.10</p>
<p> JQuery 1.12.4</p>
<p> JQuery MIgrate 1.4.1</p>
<p> Databases MySQL</p>
</blockquote>
<p>其中<code>WordPress</code>是一个广泛使用的开源CMS，基于PHP语言开发。ok，我们又获取了网页的框架信息，尝试查找这个框架的相关漏洞，并尝试利用漏洞。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfconsole<br><br>search WordPress<br></code></pre></td></tr></table></figure>

<p>可以找到有117个漏洞（很多，就不一一截图记录了）：</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629111815721.png" srcset="/img/loading.gif" lazyload alt="image-20240629111815721"></p>
<p>可以尝试使用最新的一个漏洞进行利用尝试。</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629160813860.png" srcset="/img/loading.gif" lazyload alt="image-20240629160813860"></p>
<p>利用这个23年11月的最新高等级的漏洞：</p>
<p> <code>exploit/multi/http/wp_royal_elementor_addons_rce</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">use exploit/multi/http/wp_royal_elementor_addons_rce<br><br>show options<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629161500801.png" srcset="/img/loading.gif" lazyload alt="image-20240629161500801"></p>
<p>可以看到，这里的<code>RHOSTS</code>也设置为必须设置，因此我们可以尝试设置其为目标靶机地址<code>192.168.204.131</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">set</span> RHOSTS 192.168.204.131<br><br>show options<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629161754704.png" srcset="/img/loading.gif" lazyload alt="image-20240629161754704"></p>
<p>执行运行命令：run&#x2F;exploit</p>
<p>正常来说，如果成功应用的话会返回提示信息“Meterpreter session 1 opened”</p>
<p>但是根据打印出来的提示信息，发现无论是执行run还是exploit命令，都没有session被成功创建。</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629161951832.png" srcset="/img/loading.gif" lazyload alt="image-20240629161951832"></p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629162306263.png" srcset="/img/loading.gif" lazyload alt="image-20240629162306263"></p>
<p>所以这个漏洞我们没法利用。</p>
<p>尝试利用其它漏洞，但发现修改都没办法应用执行。所以通过漏洞来实现攻击这一方法遇到了瓶颈。</p>
<p>ok！既然常规思维无法利用漏洞。那么我们就琢磨一下flag1提示的<code>cewl</code>。</p>
<blockquote>
<p>cewl -h ：帮助命令，输出所有可接受的选项参数以及对应的选项描述。</p>
<p>默认方法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">cewl http://www.ignitetechnologies.in/（指定URL）<br></code></pre></td></tr></table></figure>

<p>输入命令之后，爬虫会根据<strong>指定的URL</strong>和深度进行爬取，然后打印出可用于密码破解的字典。</p>
<p>若想将打印出的字典存储为文件，则使用<code>-w Name.txt</code>参数来将其存储为txt文件。</p>
<p>若想生成指定长度的密码字典，则通过使用<code>-m length</code>选项来设置，保证生成的密码长度至少为九位。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">cewl http://dc-2/ -w CewlDict.txt<br><br><span class="hljs-built_in">cat</span> CewlDict.txt<br></code></pre></td></tr></table></figure>

<p>得到一个可用于密码破解的字典（关键字列表）文件：</p>
<blockquote>
<p>这里访问的URL是通过域名访问的。因为前面的IP地址被重定向过。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629165118422.png" srcset="/img/loading.gif" lazyload alt="image-20240629165118422"></p>
<p>通过 cewl 获得一个可用于密码破解的字典之后。之后的正常思路就是寻找登陆界面进行密码爆破攻击。但是前面在解决重定向问题访问靶机地址后返回的网页中，并没有显示出有关用户登陆的任何界面。</p>
<p>所以我们还得找！</p>
<p>之前进行目录爆破的时候，我们获取了三个目录链接：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://192.168.204.131/wp-content/">http://192.168.204.131/wp-content/</a></p>
<p><a target="_blank" rel="noopener" href="http://192.168.204.131/wp-includes/">http://192.168.204.131/wp-includes/</a></p>
<p><a target="_blank" rel="noopener" href="http://192.168.204.131/wp-admin/">http://192.168.204.131/wp-admin/</a></p>
</blockquote>
<p>在kali（本地物理主机的hosts文件未修改，wp-admin界面依然会被重定向到dc-2造成错误）中分别再次访问这三个网页。</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="http://192.168.204.131/wp-content/">http://192.168.204.131/wp-content/</a></p>
<p>依然没有任何东西：</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629170926175.png" srcset="/img/loading.gif" lazyload alt="image-20240629170926175"></p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://192.168.204.131/wp-includes/">http://192.168.204.131/wp-includes/</a></p>
<p>返回的内容仍然是之前的那些，不知道有何作用，没有找到啥有价值的东西。</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629171052842.png" srcset="/img/loading.gif" lazyload alt="image-20240629171052842"></p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://192.168.204.131/wp-admin/">http://192.168.204.131/wp-admin/</a></p>
<p>原本是无响应的被重定向的界面，现在返回了一个登陆界面。</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629171202086.png" srcset="/img/loading.gif" lazyload alt="image-20240629171202086"></p>
</li>
</ul>
<p>ok！登陆界面找到啦！！！</p>
<p>捋一下，现在密码字典有了，登陆界面有了，剩下还需要查找用户名，就可以进行密码爆破了。</p>
<h2 id="wpscan扫描"><a href="#wpscan扫描" class="headerlink" title="wpscan扫描"></a>wpscan扫描</h2><p>什么是wpscan扫描？</p>
<table>
<thead>
<tr>
<th align="left"><code>WPScan</code>是一个扫描 <code>WordPress</code> 漏洞的黑盒子扫描器，它可以为所有 <code>Web</code> 开发人员扫描 <code>WordPress</code> 漏洞并在他们开发前找到并解决问题。常搭配<code>Nikto</code>使用，一款非常棒的<code>Web</code> 服务器评估工具。</th>
</tr>
</thead>
</table>
<p>使用教程：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_41924764/article/details/120984618%EF%BC%88WPScan%E4%BD%BF%E7%94%A8%E5%AE%8C%E6%95%B4%E6%95%99%E7%A8%8B%E4%B9%8B%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%AF%B9WordPress%E7%9A%84%E6%B8%97%E9%80%8F%E8%BF%87%E7%A8%8B%EF%BC%89">https://blog.csdn.net/weixin_41924764/article/details/120984618（WPScan使用完整教程之记一次对WordPress的渗透过程）</a></p>
<p>为什么是wpscan？</p>
<p>因为前面进行指纹识别的时候得到的网站信息，其使用了<code>WordPress</code>框架。</p>
<h3 id="wpscan扫描WordPress有效用户"><a href="#wpscan扫描WordPress有效用户" class="headerlink" title="wpscan扫描WordPress有效用户"></a>wpscan扫描WordPress有效用户</h3><p>通过扫描在wordpress中有效的用户，确定用户的用户名，进而使用密码字典进行爆破。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wpscan --url http://dc-2/ -e u<br></code></pre></td></tr></table></figure>

<p>执行命令（注意是<code>--url</code>两条<code>-</code>哦）。</p>
<p>在查询结果中，有一块<code>User(s) Identified:</code>（已认证用户）模块选项：</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629180120896.png" srcset="/img/loading.gif" lazyload alt="image-20240629180120896"></p>
<p>可以看到，有三个已通过认证的用户：</p>
<blockquote>
<p>admin</p>
<p>jerry</p>
<p>tom</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">touch</span> usersname.txt<br>vim usersname.txt<br><span class="hljs-built_in">cat</span> usersname.txt<br></code></pre></td></tr></table></figure>

<p>新建一个文件，将用户名存入文件中，保存退出，cat查看文件内容。</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629182533839.png" srcset="/img/loading.gif" lazyload alt="image-20240629182533839"></p>
<h3 id="爆破用户密码"><a href="#爆破用户密码" class="headerlink" title="爆破用户密码"></a>爆破用户密码</h3><p>使用获取得到的用户名字典和密码字典进行爆破，获取可登陆用户账户。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wpscan --url http://dc-2/ -U usersname.txt -P CewlDict.txt<br></code></pre></td></tr></table></figure>

<p><code>-U</code>：指定用户名字典</p>
<p><code>-P</code>：指定密码爆破字典</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629185111829.png" srcset="/img/loading.gif" lazyload alt="image-20240629185111829"></p>
<p>爆破出两个普通用户的账户密码咯！</p>
<blockquote>
<p>Username: jerry, Password: adipiscing</p>
<p>Username: tom, Password: parturient</p>
</blockquote>
<p>使用这两个账号登陆（这里使用jerry的登陆）：</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629185920193.png" srcset="/img/loading.gif" lazyload alt="image-20240629185920193"></p>
<p>浏览当前页面信息，并没有一些有用的信息。</p>
<p>继续浏览其它模块的界面：</p>
<p>在<code>Pages</code>模块发现了选项Flag2:</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629191506509.png" srcset="/img/loading.gif" lazyload alt="image-20240629191506509"></p>
<p>点进去查看其内容：</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629191548650.png" srcset="/img/loading.gif" lazyload alt="image-20240629191548650"></p>
<blockquote>
<p>If you can’t exploit WordPress and take a shortcut, there is another way.</p>
<p>Hope you found another entry point.</p>
<p>如果你不能利用WordPress走捷径，还有另一种方法。</p>
<p>希望你能找到另一个入口。</p>
</blockquote>
<p>此提示也验证了之前我们试图通过Metasploit进行WordPress漏洞的利用是行不通的。</p>
<p>再来捋一下，我们目前已经获取了用于登陆的两个用户名和密码。且已经明确了无法通过漏洞利用进行 Getshell 以及提权。</p>
<p>所以我们接下来可以尝试使用已获取的用户密码连接服务器！</p>
<h2 id="ssh连接"><a href="#ssh连接" class="headerlink" title="ssh连接"></a>ssh连接</h2><p>由前面的端口扫描可知，目标靶机开放的端口只有两个<code>80</code>端口和<code>7744</code>端口。</p>
<p>80端口常用于web网页http服务。代表http协议。通过上述操作，通过网页操作能获得的信息几近尽头。所以我们从7744端口进行切入。由提示信息，7744端口代表的是ssh协议，用于远程服务器连接。</p>
<p>跟自己远程连接kali的操作类似，只不过这里指定了7744端口：</p>
<ul>
<li>对 jerry 账号进行尝试</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh jerry@192.168.204.131 -p 7744<br></code></pre></td></tr></table></figure>

<p>但尝试后发现，无论是手打还是复制粘贴，请求都被拒绝了，因此排除密码输入错误的情况。</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629192912615.png" srcset="/img/loading.gif" lazyload alt="image-20240629192912615"></p>
<ul>
<li>对 tom 账号进行尝试</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh tom@192.168.204.131 -p 7744<br></code></pre></td></tr></table></figure>

<p>ok！成功登陆上了！</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629193140246.png" srcset="/img/loading.gif" lazyload alt="image-20240629193140246"></p>
<p>连上之后先 <code>ls</code>查看用户下的目录文件：</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629200237330.png" srcset="/img/loading.gif" lazyload alt="image-20240629200237330"></p>
<p>只有flag3文件，usr是系统资源文件，没啥太大的参考意义。</p>
<p><code>cat flag3.txt</code>查看文件内容，发现没有找到<code>cat</code>命令，判定为命令限制。</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629201414849.png" srcset="/img/loading.gif" lazyload alt="image-20240629201414849"></p>
<p>使用指令查看能够使用的命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">compgen -c<br></code></pre></td></tr></table></figure>

<p>结果如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629201941121.png" srcset="/img/loading.gif" lazyload alt="image-20240629201941121"></p>
<p>有很多命令捏，在末尾处有一个常见的linux文件操作指令<code>vi</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629202023822.png" srcset="/img/loading.gif" lazyload alt="image-20240629202023822"></p>
<p>使用 vi 打开 flag3.txt 文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi flag3.txt<br></code></pre></td></tr></table></figure>

<p>权限不够，提示要提权：</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629202509198.png" srcset="/img/loading.gif" lazyload alt="image-20240629202509198"></p>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>根据 flag3.txt 文件的提示，我们应该实现<strong>提权</strong>操作。根据上述<code>compgen -c</code>得到的命令信息，<code>vi</code>是linux下常见的文件操作命令。而且vi是vim的先前版本。通过网络搜索得知，vim能够用来实现提权。</p>
<blockquote>
<p>vim的主要用途是作为文本编辑器，但若其作为SUID运行，它将继承root用户的权限，因此它可以读取系统上的所有文件。</p>
<p>vim.tiny &#x2F;etc&#x2F;shadow 访问高密级文件</p>
<p>还可以通过vim打开shell</p>
<p>vim.tiny</p>
<p>：set shell&#x3D;&#x2F;bin&#x2F;sh</p>
<p>：shell</p>
</blockquote>
<p>首先，先使用<code>vi</code>命令随机打开一个文件（flag3.txt），然后按照保存长度文件的步骤，先<code>Esc + ：号</code>输入<code>set shell=/bin/sh</code>，回车，然后再<code>：号</code>输入<code>shell</code>点击回车即可。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">：<span class="hljs-built_in">set</span> shell=/bin/sh<br><br>：shell<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629204801206.png" srcset="/img/loading.gif" lazyload alt="image-20240629204801206"></p>
<p><code>cd ..</code>返回上一级目录，执行ls的时候发现存在 jerry 和 tom 两个文件夹，可以说是实现了部分提权但仍未获得root用户权限。</p>
<p>进入jerry文件夹：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> jerry<br><br><span class="hljs-built_in">ls</span><br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629205337373.png" srcset="/img/loading.gif" lazyload alt="image-20240629205337373"></p>
<p>可以看到有个 flag4 文件，查看其内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi flag4.txt<br></code></pre></td></tr></table></figure>

<p>（注意不是<code>cat</code>哦！cat被限制了）</p>
<p>得到如下信息：</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629205603521.png" srcset="/img/loading.gif" lazyload alt="image-20240629205603521"></p>
<p>根据提示信息，我们还需要去找到最后一个<code>flag</code>，而且它不给我们提示了。</p>
<p>接下来尝试<code>rbash绕过</code>来实现提权。</p>
<table>
<thead>
<tr>
<th align="left">rbash 是 restricted bash 的缩写，意思是受限制的 bash。它与shell的区别在于会限制一些行为，让一些命令无法执行。（本文中cat命令被限制）</th>
</tr>
</thead>
</table>
<blockquote>
<ul>
<li>RBASH 是一种特殊的 shell，它限制了用户的一些操作和权限，例如：<ul>
<li>不能使用 cd 命令来改变当前目录。</li>
<li>不能使用 set 命令来改变环境变量或 shell 选项。</li>
<li>不能使用 unset 命令来取消环境变量或 shell 函数。</li>
<li>不能使用任何包含 &#x2F; 符号的命令，除非它们在 PATH 环境变量中指定了。</li>
<li>不能重定向输入或输出，例如使用 &gt;, &lt;, &gt;&gt;, &lt;&lt; 等符号。</li>
<li>只能执行 PATH 环境变量中指定的命令，而且 PATH 环境变量通常只包含一些基本的命令，例如 ls, cat, echo 等。</li>
</ul>
</li>
<li>RBASH 的目的是为了提高系统的安全性，防止用户执行一些危险或不合法的操作。</li>
</ul>
</blockquote>
<p>学习文档：<a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/376922.html%EF%BC%88Linux%E6%8F%90%E6%9D%83%E4%B9%8Brbash%E7%BB%95%E8%BF%87%EF%BC%89">https://www.freebuf.com/vuls/376922.html（Linux提权之rbash绕过）</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> -p   // 查看环境变量<br><br>BASH_CMDS[a]=/bin/sh;a  // 把/bin/sh;a这个值赋值给目标数组位置<br><br>执行 /bin/bash 命令 // 退出返回当前普通tom用户<br><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:/bin  // 添加环境变量<br><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:/usr/bin // 添加环境变量<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629211244365.png" srcset="/img/loading.gif" lazyload alt="image-20240629211244365"></p>
<p>添加完环境变量后，<code>ls</code>查看当前目录内容，<code>compgen -c</code>查看当前支持的指令。</p>
<p>结果显示出了绕过之前<code>compgen -c</code>所没有的很多命令，说明rbash绕过成功。</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629212249196.png" srcset="/img/loading.gif" lazyload alt="image-20240629212249196"></p>
<p>尝试<code>sudo su</code>提权，但结果还是没能成功。</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629212501959.png" srcset="/img/loading.gif" lazyload alt="image-20240629212501959"></p>
<p>因此需要继续提权。再仔细查看绕过后系统允许的命令，发现有<code>find</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629212610412.png" srcset="/img/loading.gif" lazyload alt="image-20240629212610412"></p>
<p>我们上一个靶场利用<code>find</code>命令成功进行了提权，那这次也一样捏！</p>
<p>首先利用find命令，查看具有SUID权限的可执行二进制文件（命令）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">find / -perm -u=s -<span class="hljs-built_in">type</span> f 2&gt;/dev/null<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629212859976.png" srcset="/img/loading.gif" lazyload alt="image-20240629212859976"></p>
<p>发现好像没啥文件可利用。而上一个靶场中<code>find</code>命令也具有SUID权限。</p>
<p>尝试切换用户！切换到 jerry账户 ！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">su &lt;用户名jerry&gt;  // 然后输入jerry的密码即可<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629214309315.png" srcset="/img/loading.gif" lazyload alt="image-20240629214309315"></p>
<p><code>sudo -l</code>查看sudo的配置文件</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629214442931.png" srcset="/img/loading.gif" lazyload alt="image-20240629214442931"></p>
<p>可以得到的信息是，<code> (root) NOPASSWD: /usr/bin/git</code>git命令是root权限的。</p>
<p><strong>git命令可以实现提权</strong></p>
<blockquote>
<p>方法一：</p>
<p>sudo git help config</p>
<p>!&#x2F;bin&#x2F;bash 或 !’sh’</p>
<p>方法二：</p>
<p>sudo git -p help</p>
<p>!&#x2F;bin&#x2F;bash </p>
</blockquote>
<p>首先先再用户命令行界面输入 <code>sudo git help config</code>，然后他会跳转到一个文件处，什么都不用管，直接复制<code>!/bin/bash 或 !&#39;sh&#39;</code>然后回车。</p>
<p>可以发现，现在已经是root用户了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629220012985.png" srcset="/img/loading.gif" lazyload alt="image-20240629220012985"></p>
<p>但是执行<code>ls</code>的时候可以发现，当前目录下仍然只有 flag3 这个文件。根据命令行显示提示，我们是在root下的 &#x2F;home&#x2F;tom目录 执行的 ls 命令。</p>
<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629215624770.png" srcset="/img/loading.gif" lazyload alt="image-20240629215624770"></p>
<p>执行两次 <code>cd ..</code>退回到 root 根目录。然后再执行一次 ls命令，可以得到<code> final-flag.txt</code>文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> final-flag.txt<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/haoisbinlove/Blogimage@main/image/image-20240629220312912.png" srcset="/img/loading.gif" lazyload alt="image-20240629220312912"></p>
<p>提权成功！</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li><p>第一步工作就是确认目标靶机的IP地址。通过开关靶机或者nmap扫描实现</p>
</li>
<li><p>第二步工作就是进行端口扫描，扫描开放端口，试图从中获取一些有用的信息</p>
</li>
<li><p>第三步工作就是尝试进行目录爆破。到这一步为止的步骤和dc-1的步骤类似</p>
</li>
<li><p>通过<strong>指纹工具</strong>识别出网站使用的框架是<strong>wordpress</strong>，这类框架的漏洞常可以使用<strong>wpscan</strong>进行扫描。使用<strong>wpscan</strong>进行用户名信息扫描。</p>
</li>
<li><p>根据<strong>flag提示</strong>得知可以使用<strong>cewl</strong> ，使用其可以针对特定域名（URL）进行密码爆破字典生成。</p>
</li>
<li><p>有了<strong>密码字典</strong>以及<strong>用户名信息</strong>之后使用<strong>wpscan</strong>进行有效用户账户的爆破。</p>
</li>
<li><p>通过SSH连接来<strong>Getshell</strong>。通过利用可以使用的命令来进行提权，当仍有命令限制的时候，无法获取root权限的时候尝试使用<strong>rbash绕过</strong>来进行提权。</p>
</li>
<li><p>切换用户，查看sudo配置信息，试图获取有用信息，<strong>利用命令进行提权</strong>。最后进入root目录查看文件获取最后一个flag。</p>
</li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>DC-2</div>
      <div>http://example.com/2024/07/24/DC-2/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>John Doe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年7月24日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/07/24/DC-4/" title="DC-4">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">DC-4</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/07/24/DC-1/" title="DC-1">
                        <span class="hidden-mobile">DC-1</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
